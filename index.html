<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReTex SL - Interface Tactique</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        .crt-overlay {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .btn-glitch:active {
            transform: translateY(2px);
        }

        /* FOF Logo specific styles */
        .fof-logo-circle {
            /* Default size for main menu */
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #0d2847;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border: 2px solid #2a6ecb;
            box-shadow: 0 0 15px rgba(42, 110, 203, 0.6);
            transition: all 0.3s ease;
        }
        
        /* Small variant for headers */
        .fof-logo-circle.small {
            width: 48px;
            height: 48px;
            border-width: 1px;
            box-shadow: 0 0 8px rgba(42, 110, 203, 0.4);
        }

        .fof-logo-circle::before {
            content: "";
            position: absolute;
            width: 90%;
            height: 90%;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-sizing: border-box;
            opacity: 0.8;
            pointer-events: none;
        }

        .fof-logo-img {
            width: 75%;
            height: 75%;
            object-fit: contain;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- CONFIGURATION ---
        const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1447173514871443548/aA61xuROKVY4dYquPZ7PT0D35PMG7VVGAWCFTENUSODKhWUP0agxuuHKE3gN6P0D1JJs";

        // --- Network ---
        const sendToDiscord = async (embedData, callback) => {
            try {
                const response = await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        embeds: [embedData]
                    }),
                });

                if (response.ok) {
                    callback('success');
                } else {
                    console.error("Discord Error:", response.status);
                    callback('error');
                }
            } catch (error) {
                console.error("Network Error:", error);
                callback('error');
            }
        };

        // --- Icons ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"/></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6"/></IconBase>;
        const ChevronLeft = (props) => <IconBase {...props}><polyline points="15 18 9 12 15 6"/></IconBase>;
        const Shield = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></IconBase>;
        const Target = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconBase>;
        const Radio = (props) => <IconBase {...props}><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></IconBase>;
        const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const UserPlus = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></IconBase>;
        const Send = (props) => <IconBase {...props}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></IconBase>;
        const Loader = (props) => <IconBase {...props} className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;

        // --- Data ---
        const EVAL_OPTIONS = [
            { id: 'na', label: 'NON ACQUIS', short: 'NON', color: 'bg-red-900/50 border-red-500 text-red-200', discordColor: 0xef4444, icon: X },
            { id: 'ec', label: 'EN COURS', short: 'EN COURS', color: 'bg-amber-900/50 border-amber-500 text-amber-200', discordColor: 0xf59e0b, icon: Activity },
            { id: 'ac', label: 'ACQUIS', short: 'ACQUIS', color: 'bg-emerald-900/50 border-emerald-500 text-emerald-200', discordColor: 0x10b981, icon: Check },
            { id: 'no', label: 'NON OBS.', short: 'N.O.', color: 'bg-slate-700/50 border-slate-500 text-slate-300', discordColor: 0x94a3b8, icon: Radio },
        ];

        const CATEGORIES = [
            { id: 'cat_cmd', title: 'COMMANDEMENT', icon: Users, items: [{ id: 'posture', label: 'Posture' }, { id: 'comms', label: 'Communication' }, { id: 'stress', label: 'Humain & Stress' }] },
            { id: 'cat_tac', title: 'TACTIQUE', icon: Target, items: [{ id: 'analyse', label: 'Analyse Terrain' }, { id: 'decision', label: 'Prise D√©cision' }, { id: 'coord', label: 'Coordination' }] },
            { id: 'cat_e2', title: '√âCHELON 2', icon: Shield, items: [{ id: 'pedago', label: 'P√©dagogie' }, { id: 'vision', label: 'Vision Globale' }] }
        ];

        // --- Shared Components ---
        const Logo = ({ small = false }) => (
            <div className={`fof-logo-circle ${small ? 'small' : ''}`}>
                <img src="logo.png" alt="FOF Logo" className="fof-logo-img" onError={(e) => {
                    e.target.style.display = 'none';
                    e.target.parentNode.style.backgroundColor = '#0d2847';
                    // Fallback to text if image fails
                    const span = document.createElement('span');
                    span.innerText = 'FOF';
                    span.style.color = 'white';
                    span.style.fontWeight = 'bold';
                    span.style.fontSize = small ? '12px' : '20px';
                    e.target.parentNode.appendChild(span);
                }}/>
            </div>
        );

        const StepIndicator = ({ currentStep, totalSteps, label }) => (
            <div className="flex items-center space-x-2 mb-6">
                {Array.from({ length: totalSteps }).map((_, index) => (
                    <div key={index} className={`h-2 flex-1 rounded-sm transition-all duration-300 ${index <= currentStep ? 'bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.5)]' : 'bg-slate-700'}`} />
                ))}
                <span className="font-mono text-xs text-indigo-400 ml-2 whitespace-nowrap">{label} {currentStep + 1}/{totalSteps}</span>
            </div>
        );

        const InputField = ({ label, value, onChange, placeholder, type = "text" }) => (
            <div className="flex flex-col space-y-1 w-full">
                <label className="text-xs font-mono text-slate-400 uppercase tracking-wide">{label}</label>
                <input type={type} value={value} onChange={(e) => onChange(e.target.value)} placeholder={placeholder} className="bg-slate-800/80 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all placeholder-slate-600 font-mono text-white w-full" />
            </div>
        );

        const TextArea = ({ label, value, onChange, placeholder, height = "h-24" }) => (
            <div className="flex flex-col space-y-1 w-full">
                <label className="text-xs font-mono text-slate-400 uppercase tracking-wide flex justify-between"><span>{label}</span><span className="text-slate-600">{value.length} chars</span></label>
                <textarea value={value} onChange={(e) => onChange(e.target.value)} placeholder={placeholder} className={`bg-slate-800/80 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all placeholder-slate-600 font-mono resize-none w-full ${height}`} />
            </div>
        );

        // --- PREVIEW CARD COMPONENT (Visual representation of Discord Embed) ---
        const PreviewCard = ({ title, color, fields, footer }) => {
            const borderColorMap = {
                'green': 'border-l-emerald-500',
                'blue': 'border-l-indigo-500',
                'amber': 'border-l-amber-500',
                'red': 'border-l-red-500'
            };
            const borderColor = borderColorMap[color] || 'border-l-slate-500';

            return (
                <div className={`bg-[#2b2d31] rounded-r border-l-[4px] ${borderColor} p-4 shadow-xl max-w-full overflow-hidden`}>
                    <div className="flex items-center mb-4">
                         <div className="font-bold text-base text-white">{title}</div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {fields.map((field, idx) => (
                            <div key={idx} className={`${field.full ? 'col-span-1 md:col-span-2' : ''} mb-1`}>
                                <div className="text-xs font-bold text-[#b5bac1] uppercase mb-1">{field.name}</div>
                                <div className="text-sm text-[#dbdee1] whitespace-pre-wrap">{field.value}</div>
                            </div>
                        ))}
                    </div>
                    <div className="mt-4 pt-2 border-t border-[#3f4147] flex items-center">
                        <span className="text-[10px] text-[#949ba4]">{footer}</span>
                        <span className="text-[10px] text-[#949ba4] ml-auto">{new Date().toLocaleDateString()}</span>
                    </div>
                </div>
            );
        };

        const SendButton = ({ embedData, onSent }) => {
            const [status, setStatus] = useState('idle');

            const handleSend = () => {
                setStatus('sending');
                sendToDiscord(embedData, (result) => {
                    if (result === 'success') {
                        setStatus('sent');
                        if(onSent) onSent();
                    } else {
                        setStatus('error');
                        setTimeout(() => setStatus('idle'), 3000);
                    }
                });
            };

            return (
                <button 
                    onClick={handleSend}
                    disabled={status === 'sending' || status === 'sent'}
                    className={`w-full py-4 rounded font-bold uppercase tracking-widest transition-all flex items-center justify-center space-x-3 shadow-lg transform hover:scale-[1.02] active:scale-95
                    ${status === 'sent'
                        ? 'bg-emerald-600 text-white shadow-emerald-900/50'
                        : status === 'error'
                            ? 'bg-red-600 text-white'
                            : 'bg-indigo-600 hover:bg-indigo-500 text-white shadow-indigo-500/30'}`}
                >
                    {status === 'sending' ? (
                        <Loader size={24} />
                    ) : status === 'sent' ? (
                        <Check size={24} />
                    ) : status === 'error' ? (
                        <X size={24} />
                    ) : (
                        <Send size={24} />
                    )}
                    <span className="text-sm md:text-base">
                        {status === 'sending' ? 'TRANSMISSION...' 
                        : status === 'sent' ? 'RAPPORT ENVOY√â' 
                        : status === 'error' ? 'ERREUR - R√âESSAYER' 
                        : 'TRANSMETTRE AU QG'}
                    </span>
                </button>
            );
        };

        // --- SUB-APP: STUDENT REQUEST FORM ---
        const StudentInterface = ({ onBack }) => {
            const [step, setStep] = useState(0);
            const [data, setData] = useState({ name: '', target: 'SL1', objectives: '', availability: '' });

            const update = (f, v) => setData(p => ({ ...p, [f]: v }));

            const buildEmbed = () => ({
                title: `üéì DEMANDE DE SUIVI : ${data.name.toUpperCase()}`,
                color: 5814783, // Indigo equivalent
                fields: [
                    { name: "üéØ NIVEAU VIS√â", value: data.target, inline: true },
                    { name: "üìÖ DISPONIBILIT√âS", value: data.availability || "√Ä d√©finir", inline: false },
                    { name: "üìù AXES DE TRAVAIL", value: data.objectives || "Non sp√©cifi√©", inline: false }
                ],
                footer: { text: "FOF - Module Formation" }
            });

            return (
                <div className="animate-in fade-in slide-in-from-right-8 duration-300">
                     <header className="mb-6 border-b border-indigo-500/30 pb-4 flex items-center justify-between">
                        <div>
                            <h2 className="text-xl font-bold text-indigo-400 flex items-center space-x-2">
                                <UserPlus size={24}/>
                                <span>DEMANDE DE SUIVI</span>
                            </h2>
                            <p className="text-xs text-slate-500 font-mono mt-1">MODULE STAGIAIRE</p>
                        </div>
                        <Logo small={true} />
                    </header>

                    <StepIndicator currentStep={step} totalSteps={2} label="ETAPE" />

                    {step === 0 ? (
                        <div className="space-y-6">
                            <InputField label="Identit√©" placeholder="Ex: Recrue Joker" value={data.name} onChange={v => update('name', v)} />
                            
                            <div className="bg-slate-800/50 p-4 rounded border border-slate-700">
                                <label className="text-xs font-mono text-slate-400 uppercase tracking-wide mb-2 block">Niveau Vis√©</label>
                                <div className="grid grid-cols-2 gap-3">
                                    {['SL1', 'SL2'].map(lvl => (
                                        <button key={lvl} onClick={() => update('target', lvl)} className={`py-3 px-4 rounded font-bold font-mono transition-all ${data.target === lvl ? 'bg-indigo-600 text-white shadow-lg border border-indigo-400' : 'bg-slate-700 text-slate-400 hover:bg-slate-600 border border-transparent'}`}>{lvl}</button>
                                    ))}
                                </div>
                            </div>

                            <TextArea label="Objectifs / Besoins" placeholder="D√©crivez vos besoins..." value={data.objectives} onChange={v => update('objectives', v)} />
                            <TextArea label="Disponibilit√©s" placeholder="Vos cr√©neaux..." value={data.availability} onChange={v => update('availability', v)} height="h-20" />
                            
                            <div className="flex justify-end pt-4">
                                <button onClick={() => setStep(1)} className="w-full md:w-auto bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded font-bold flex items-center justify-center space-x-2 transition-all shadow-lg shadow-indigo-500/20">
                                    <span>PR√âVISUALISER</span>
                                    <ChevronRight size={16} />
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="space-y-6">
                            <div className="text-center text-sm text-slate-400 mb-2">APERCU DU MESSAGE S√âCURIS√â</div>
                            
                            <PreviewCard 
                                title={`üéì DEMANDE DE SUIVI : ${data.name.toUpperCase()}`}
                                color="blue"
                                fields={[
                                    { name: "üéØ NIVEAU VIS√â", value: data.target, full: false },
                                    { name: "üìÖ DISPONIBILIT√âS", value: data.availability || "√Ä d√©finir", full: true },
                                    { name: "üìù AXES DE TRAVAIL", value: data.objectives || "Non sp√©cifi√©", full: true }
                                ]}
                                footer="FOF - Module Formation"
                            />
                            
                            <div className="pt-4">
                                <SendButton embedData={buildEmbed()} onSent={() => setTimeout(() => {setData({ name: '', target: 'SL1', objectives: '', availability: '' }); setStep(0);}, 2000)} />
                                <button onClick={() => setStep(0)} className="w-full text-center text-slate-500 hover:text-white text-xs font-mono mt-4 py-2">RELIRE / MODIFIER</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- SUB-APP: MENTOR RETEX FORM ---
        const MentorInterface = ({ onBack }) => {
            const [step, setStep] = useState(0);
            const [formData, setFormData] = useState({
                missionDate: new Date().toISOString().split('T')[0],
                mentorName: '', menteeName: '', missionType: 'Entrainement', echelon: 'SL1',
                posture: 'no', comms: 'no', stress: 'no', analyse: 'no', decision: 'no', coord: 'no', pedago: 'no', vision: 'no',
                keep: '', drop: '', objective: '', nextStep: ''
            });

            const updateField = (f, v) => setFormData(p => ({ ...p, [f]: v }));
            const next = () => setStep(p => Math.min(p + 1, 3));
            const prev = () => setStep(p => Math.max(p - 1, 0));
            
            const getEval = (key) => EVAL_OPTIONS.find(o => o.id === formData[key]);

            const buildEmbed = () => {
                // Determine color based on "Avis Mentor"
                let color = 10181046; // Gray default
                if (formData.nextStep.includes('Validation')) color = 5763719; // Green
                else if (formData.nextStep.includes('Difficult√©')) color = 15548997; // Red
                else if (formData.nextStep.includes('Conforme')) color = 3447003; // Blue
                
                // Build Evaluation String Grid
                const buildGrid = (catId) => {
                    const cat = CATEGORIES.find(c => c.id === catId);
                    return cat.items.map(item => {
                        const evalData = getEval(item.id);
                        return `**${item.label}:** ${evalData ? evalData.short : 'N/A'}`;
                    }).join('\n');
                };

                const fields = [
                    { name: "üìã INFO MISSION", value: `**Date:** ${formData.missionDate}\n**Type:** ${formData.missionType}`, inline: true },
                    { name: "üë§ ACTEURS", value: `**Mentor:** ${formData.mentorName}\n**√âl√®ve:** ${formData.menteeName} (${formData.echelon})`, inline: true },
                    
                    { name: "-------------------------------------------", value: "**√âVALUATION COMP√âTENCES**", inline: false },
                    
                    { name: "üëÆ COMMANDEMENT", value: buildGrid('cat_cmd'), inline: true },
                    { name: "üéØ TACTIQUE", value: buildGrid('cat_tac'), inline: true },
                ];

                if(formData.echelon === 'SL2') {
                    fields.push({ name: "üõ°Ô∏è √âCHELON 2", value: buildGrid('cat_e2'), inline: true });
                }

                fields.push(
                    { name: "-------------------------------------------", value: "**ANALYSE**", inline: false },
                    { name: "‚úÖ POINTS FORTS (KEEP)", value: formData.keep || "RAS", inline: false },
                    { name: "‚ö†Ô∏è √Ä TRAVAILLER (FIX)", value: formData.drop || "RAS", inline: false },
                    { name: "üîÆ SUIVI", value: `**Prochain Obj:** ${formData.objective}\n**Avis:** ${formData.nextStep || 'Non d√©fini'}`, inline: false }
                );

                return {
                    title: `üìÑ RETEX MISSION : ${formData.menteeName.toUpperCase()}`,
                    color: color,
                    fields: fields,
                    footer: { text: "FOF - Force Op√©rationnelle Fran√ßaise" }
                };
            };

            const EvalButton = ({ option, selected, onClick }) => {
                const Icon = option.icon;
                return (
                    <button onClick={onClick} className={`flex flex-col items-center justify-center p-2 rounded border transition-all w-full h-full min-h-[60px] ${selected ? `${option.color} shadow-lg ring-1 ring-white/20 scale-[1.02]` : 'bg-slate-800/50 border-slate-700 text-slate-500 hover:bg-slate-800'}`}>
                        <Icon size={18} className="mb-1" /><span className="text-[10px] font-bold font-mono">{option.short}</span>
                    </button>
                );
            };

            return (
                <div className="animate-in fade-in slide-in-from-right-8 duration-300">
                    <header className="mb-6 border-b border-indigo-500/30 pb-4 flex items-center justify-between">
                        <div>
                            <h2 className="text-xl font-bold text-indigo-400 flex items-center space-x-2">
                                <Shield size={24}/>
                                <span>COMPTE RENDU</span>
                            </h2>
                            <p className="text-xs text-slate-500 font-mono mt-1">MODULE MENTOR</p>
                        </div>
                        <Logo small={true} />
                    </header>

                    <StepIndicator currentStep={step} totalSteps={4} label="PHASE" />

                    {step === 0 && (
                        <div className="space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <InputField label="Date" type="date" value={formData.missionDate} onChange={v => updateField('missionDate', v)} />
                                <div className="flex flex-col space-y-1 w-full">
                                    <label className="text-xs font-mono text-slate-400 uppercase tracking-wide">Type</label>
                                    <select value={formData.missionType} onChange={(e) => updateField('missionType', e.target.value)} className="bg-slate-800/80 border border-slate-700 rounded p-3 text-sm font-mono text-white w-full"><option>Entrainement</option><option>Op√©ration R√©elle</option><option>Certification</option></select>
                                </div>
                            </div>
                            <InputField label="Mentor" value={formData.mentorName} onChange={v => updateField('mentorName', v)} />
                            <InputField label="Stagiaire" value={formData.menteeName} onChange={v => updateField('menteeName', v)} />
                            <div className="bg-slate-800/50 p-3 rounded border border-slate-700 flex space-x-2">
                                {['SL1', 'SL2'].map(lvl => (
                                    <button key={lvl} onClick={() => updateField('echelon', lvl)} className={`flex-1 py-2 rounded font-mono font-bold ${formData.echelon === lvl ? 'bg-indigo-600 text-white shadow' : 'bg-slate-700 text-slate-400'}`}>{lvl}</button>
                                ))}
                            </div>
                        </div>
                    )}

                    {step === 1 && (
                        <div className="space-y-6 max-h-[50vh] overflow-y-auto pr-1">
                            {CATEGORIES.map((cat) => {
                                if (cat.id === 'cat_e2' && formData.echelon !== 'SL2') return null;
                                const CatIcon = cat.icon;
                                return (
                                    <div key={cat.id} className="bg-slate-800/20 p-3 rounded-lg border border-slate-700/50">
                                        <div className="flex items-center text-indigo-400 border-b border-slate-700/50 pb-2 mb-3"><CatIcon size={16} className="mr-2" /><h3 className="text-xs font-bold uppercase">{cat.title}</h3></div>
                                        <div className="space-y-4">
                                            {cat.items.map((item) => (
                                                <div key={item.id} className="space-y-2">
                                                    <span className="text-xs text-slate-300 block font-semibold">{item.label}</span>
                                                    <div className="grid grid-cols-4 gap-2">
                                                        {EVAL_OPTIONS.map((opt) => <EvalButton key={opt.id} option={opt} selected={formData[item.id] === opt.id} onClick={() => updateField(item.id, opt.id)} />)}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {step === 2 && (
                        <div className="space-y-4">
                            <div className="bg-emerald-900/10 border-l-4 border-emerald-500 p-3"><h3 className="text-emerald-400 font-bold text-xs mb-1">KEEP (Points Forts)</h3><TextArea value={formData.keep} onChange={v => updateField('keep', v)} height="h-20" /></div>
                            <div className="bg-amber-900/10 border-l-4 border-amber-500 p-3"><h3 className="text-amber-400 font-bold text-xs mb-1">FIX (√Ä corriger)</h3><TextArea value={formData.drop} onChange={v => updateField('drop', v)} height="h-20" /></div>
                            <div className="pt-2 border-t border-slate-700 space-y-3">
                                <InputField label="Prochain Objectif" value={formData.objective} onChange={v => updateField('objective', v)} />
                                <div className="flex flex-col space-y-1 w-full"><label className="text-xs font-mono text-slate-400 uppercase tracking-wide">Avis Global</label><select value={formData.nextStep} onChange={(e) => updateField('nextStep', e.target.value)} className="bg-slate-800/80 border border-slate-700 rounded p-3 text-sm font-mono text-white w-full"><option value="">-- CHOISIR --</option><option>Progression Conforme</option><option>Progression Lente</option><option>En Difficult√©</option><option>Pr√™t pour Validation</option></select></div>
                            </div>
                        </div>
                    )}

                    {step === 3 && (
                        <div className="space-y-6">
                             <div className="text-center text-sm text-slate-400 mb-2">APERCU DU RAPPORT CLASSIFI√â</div>
                            
                            <PreviewCard 
                                title={`üìÑ RETEX : ${formData.menteeName.toUpperCase()}`}
                                color={formData.nextStep.includes('Validation') ? 'green' : formData.nextStep.includes('Difficult√©') ? 'red' : 'blue'}
                                fields={[
                                    { name: "MISSION", value: `${formData.missionType} | ${formData.missionDate}`, full: true },
                                    { name: "BILAN", value: `Points Forts: ${formData.keep.substring(0,50)}...\nPoints Faibles: ${formData.drop.substring(0,50)}...`, full: true },
                                    { name: "AVIS MENTOR", value: formData.nextStep || 'N/A', full: true }
                                ]}
                                footer="Version condens√©e pour affichage. Le rapport complet sera envoy√©."
                            />

                            <SendButton embedData={buildEmbed()} onSent={() => setTimeout(() => {
                                setFormData({
                                    missionDate: new Date().toISOString().split('T')[0],
                                    mentorName: '', menteeName: '', missionType: 'Entrainement', echelon: 'SL1',
                                    posture: 'no', comms: 'no', stress: 'no', analyse: 'no', decision: 'no', coord: 'no', pedago: 'no', vision: 'no',
                                    keep: '', drop: '', objective: '', nextStep: ''
                                });
                                setStep(0);
                            }, 2500)} />
                        </div>
                    )}

                    {step < 3 && (
                        <div className="flex justify-between mt-6 pt-4 border-t border-slate-800">
                            <button onClick={prev} disabled={step === 0} className={`px-4 py-2 rounded text-xs font-mono ${step === 0 ? 'text-slate-600' : 'text-slate-400 hover:text-white'}`}>RETOUR</button>
                            <button onClick={next} className="px-6 py-2 bg-slate-100 text-slate-900 rounded font-bold text-xs hover:bg-white transition-all flex items-center shadow-lg hover:shadow-white/20">SUIVANT <ChevronRight size={14} className="ml-1"/></button>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN MENU ---
        const MainMenu = ({ onSelect }) => (
            <div className="flex flex-col items-center justify-center space-y-6 h-full py-10 animate-in zoom-in-95 duration-500">
                <div className="text-center mb-6">
                    <div className="mx-auto mb-6 transform hover:scale-110 transition-transform duration-500">
                        <Logo />
                    </div>
                    
                    <h1 className="text-3xl md:text-4xl font-black tracking-widest text-white uppercase drop-shadow-[0_0_10px_rgba(255,255,255,0.2)]">
                        FOF <span className="text-indigo-500">MASTER</span>
                    </h1>
                    <div className="h-1 w-24 bg-indigo-600 mx-auto my-3 rounded-full"></div>
                    <p className="text-xs text-slate-400 font-mono tracking-widest">INTERFACE DE GESTION OP√âRATIONNELLE</p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl px-4">
                    <button onClick={() => onSelect('student')} className="group bg-slate-800 hover:bg-slate-750 border border-slate-700 hover:border-emerald-500/50 p-6 rounded-xl transition-all duration-300 flex flex-col items-center justify-center shadow-lg hover:shadow-emerald-900/20 btn-glitch relative overflow-hidden">
                         <div className="absolute inset-0 bg-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div className="p-4 bg-emerald-900/30 rounded-full text-emerald-400 group-hover:text-emerald-300 group-hover:scale-110 transition-all mb-4">
                            <UserPlus size={32} />
                        </div>
                        <h3 className="text-lg font-bold text-slate-200 group-hover:text-white mb-1">STAGIAIRE</h3>
                        <p className="text-[10px] text-slate-500 font-mono text-center">Initialiser une demande de suivi</p>
                    </button>

                    <button onClick={() => onSelect('mentor')} className="group bg-slate-800 hover:bg-slate-750 border border-slate-700 hover:border-indigo-500/50 p-6 rounded-xl transition-all duration-300 flex flex-col items-center justify-center shadow-lg hover:shadow-indigo-900/20 btn-glitch relative overflow-hidden">
                         <div className="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div className="p-4 bg-indigo-900/30 rounded-full text-indigo-400 group-hover:text-indigo-300 group-hover:scale-110 transition-all mb-4">
                            <Shield size={32} />
                        </div>
                        <h3 className="text-lg font-bold text-slate-200 group-hover:text-white mb-1">MENTOR</h3>
                        <p className="text-[10px] text-slate-500 font-mono text-center">R√©diger un compte-rendu</p>
                    </button>
                </div>
            </div>
        );

        // --- APP ORCHESTRATOR ---
        const App = () => {
            const [view, setView] = useState('menu'); 

            return (
                <div className="min-h-screen p-2 md:p-8 flex justify-center items-center md:items-start bg-[#0f172a]">
                    <div className="w-full max-w-3xl bg-[#1e232b] border border-slate-700/50 shadow-2xl rounded-2xl overflow-hidden relative flex flex-col min-h-[90vh] md:min-h-[600px]">
                        <div className="absolute inset-0 crt-overlay pointer-events-none z-50"></div>
                        
                        {/* Top Bar */}
                        <div className="bg-[#151921] px-4 py-3 border-b border-slate-800 flex justify-between items-center relative z-10">
                            {view !== 'menu' ? (
                                <button onClick={() => setView('menu')} className="text-xs font-bold font-mono text-slate-400 hover:text-white flex items-center space-x-2 px-3 py-1.5 rounded bg-slate-800 hover:bg-slate-700 transition-colors">
                                    <ChevronLeft size={14} /><span>MENU</span>
                                </button>
                            ) : <div></div>}
                            <div className="flex items-center space-x-2">
                                <div className="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                <span className="text-[10px] font-mono text-slate-500">FOF-NET SECURE</span>
                            </div>
                        </div>

                        {/* Content */}
                        <div className="p-4 md:p-8 relative z-10 flex-1 overflow-y-auto">
                            {view === 'menu' && <MainMenu onSelect={setView} />}
                            {view === 'student' && <StudentInterface onBack={() => setView('menu')} />}
                            {view === 'mentor' && <MentorInterface onBack={() => setView('menu')} />}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
